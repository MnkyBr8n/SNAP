{
  "schema_id": "notebook_schema_v2",
  "schema_version": "2.0",
  "parser_capabilities": {
    "tree_sitter": {
      "description": "AST-based code structure parser for detailed syntax analysis",
      "supported_languages": ["py", "ts", "js", "java", "go", "rs", "cpp", "c", "cs", "rb", "php", "swift", "kt", "scala"],
      "fills": [
        "code.file.*",
        "code.imports.*",
        "code.exports.*",
        "code.functions.*",
        "code.classes.*",
        "code.connections.*"
      ]
    },
    "semgrep": {
      "description": "Static analysis for security and code quality",
      "supported_languages": ["py", "ts", "js", "java", "go", "rs", "cpp", "c", "cs", "rb", "php", "swift", "kt", "scala"],
      "fills": [
        "code.security.*",
        "code.quality.*"
      ]
    },
    "tree_sitter": {
      "description": "Fallback text extraction for unsupported languages",
      "supported_languages": ["all"],
      "fills": [
        "code.file.path",
        "code.file.language",
        "code.file.loc"
      ]
    },
    "text_extractor": {
      "description": "PDF, document, and markdown text extraction",
      "supported_formats": ["pdf", "txt", "md", "docx", "html"],
      "fills": [
        "doc.*"
      ]
    },
    "csv_parser": {
      "description": "CSV and TSV structured data extraction",
      "supported_formats": ["csv", "tsv"],
      "fills": [
        "csv.*"
      ]
    }
  },
  "field_id_registry": {
    "code": [
      {
        "field_id": "code.file.path",
        "value_type": "string",
        "multi": false,
        "required": true,
        "parser": "tree_sitter",
        "fallback_parser": "basic_parser"
      },
      {
        "field_id": "code.file.language",
        "value_type": "string",
        "multi": false,
        "required": true,
        "parser": "tree_sitter",
        "fallback_parser": "basic_parser"
      },
      {
        "field_id": "code.file.loc",
        "value_type": "integer",
        "multi": false,
        "required": false,
        "parser": "tree_sitter",
        "fallback_parser": "basic_parser"
      },
      {
        "field_id": "code.file.package",
        "value_type": "string",
        "multi": false,
        "required": false,
        "parser": "tree_sitter"
      },
      {
        "field_id": "code.imports.modules",
        "value_type": "list",
        "multi": true,
        "required": false,
        "parser": "tree_sitter"
      },
      {
        "field_id": "code.imports.from_files",
        "value_type": "list",
        "multi": true,
        "required": false,
        "parser": "tree_sitter"
      },
      {
        "field_id": "code.imports.external",
        "value_type": "list",
        "multi": true,
        "required": false,
        "parser": "tree_sitter"
      },
      {
        "field_id": "code.imports.internal",
        "value_type": "list",
        "multi": true,
        "required": false,
        "parser": "tree_sitter"
      },
      {
        "field_id": "code.exports.functions",
        "value_type": "list",
        "multi": true,
        "required": false,
        "parser": "tree_sitter"
      },
      {
        "field_id": "code.exports.classes",
        "value_type": "list",
        "multi": true,
        "required": false,
        "parser": "tree_sitter"
      },
      {
        "field_id": "code.exports.constants",
        "value_type": "list",
        "multi": true,
        "required": false,
        "parser": "tree_sitter"
      },
      {
        "field_id": "code.exports.types",
        "value_type": "list",
        "multi": true,
        "required": false,
        "parser": "tree_sitter"
      },
      {
        "field_id": "code.functions.names",
        "value_type": "list",
        "multi": true,
        "required": false,
        "parser": "tree_sitter"
      },
      {
        "field_id": "code.functions.signatures",
        "value_type": "list",
        "multi": true,
        "required": false,
        "parser": "tree_sitter"
      },
      {
        "field_id": "code.functions.async",
        "value_type": "list",
        "multi": true,
        "required": false,
        "parser": "tree_sitter"
      },
      {
        "field_id": "code.functions.decorators",
        "value_type": "list",
        "multi": true,
        "required": false,
        "parser": "tree_sitter"
      },
      {
        "field_id": "code.classes.names",
        "value_type": "list",
        "multi": true,
        "required": false,
        "parser": "tree_sitter"
      },
      {
        "field_id": "code.classes.inheritance",
        "value_type": "list",
        "multi": true,
        "required": false,
        "parser": "tree_sitter"
      },
      {
        "field_id": "code.classes.methods",
        "value_type": "list",
        "multi": true,
        "required": false,
        "parser": "tree_sitter"
      },
      {
        "field_id": "code.classes.properties",
        "value_type": "list",
        "multi": true,
        "required": false,
        "parser": "tree_sitter"
      },
      {
        "field_id": "code.classes.interfaces",
        "value_type": "list",
        "multi": true,
        "required": false,
        "parser": "tree_sitter"
      },
      {
        "field_id": "code.security.vulnerabilities",
        "value_type": "list",
        "multi": true,
        "required": false,
        "parser": "semgrep"
      },
      {
        "field_id": "code.security.hardcoded_secrets",
        "value_type": "list",
        "multi": true,
        "required": false,
        "parser": "semgrep"
      },
      {
        "field_id": "code.security.sql_injection_risks",
        "value_type": "list",
        "multi": true,
        "required": false,
        "parser": "semgrep"
      },
      {
        "field_id": "code.security.xss_risks",
        "value_type": "list",
        "multi": true,
        "required": false,
        "parser": "semgrep"
      },
      {
        "field_id": "code.quality.antipatterns",
        "value_type": "list",
        "multi": true,
        "required": false,
        "parser": "semgrep"
      },
      {
        "field_id": "code.quality.code_smells",
        "value_type": "list",
        "multi": true,
        "required": false,
        "parser": "semgrep"
      },
      {
        "field_id": "code.quality.todos",
        "value_type": "list",
        "multi": true,
        "required": false,
        "parser": "semgrep"
      },
      {
        "field_id": "code.quality.deprecated_usage",
        "value_type": "list",
        "multi": true,
        "required": false,
        "parser": "semgrep"
      },
      {
        "field_id": "code.connections.depends_on",
        "value_type": "list",
        "multi": true,
        "required": false,
        "parser": "tree_sitter"
      },
      {
        "field_id": "code.connections.depended_by",
        "value_type": "list",
        "multi": true,
        "required": false,
        "parser": "tree_sitter"
      },
      {
        "field_id": "code.connections.function_calls",
        "value_type": "list",
        "multi": true,
        "required": false,
        "parser": "tree_sitter"
      },
      {
        "field_id": "code.connections.instantiates",
        "value_type": "list",
        "multi": true,
        "required": false,
        "parser": "tree_sitter"
      },
      {
        "field_id": "repo.primary_language",
        "value_type": "string",
        "multi": false,
        "required": false,
        "parser": "tree_sitter"
      },
      {
        "field_id": "repo.entrypoints",
        "value_type": "list",
        "multi": true,
        "required": false,
        "parser": "tree_sitter"
      },
      {
        "field_id": "repo.modules",
        "value_type": "list",
        "multi": true,
        "required": false,
        "parser": "tree_sitter"
      },
      {
        "field_id": "repo.test_framework",
        "value_type": "string",
        "multi": false,
        "required": false,
        "parser": "tree_sitter"
      },
      {
        "field_id": "repo.ci_pipeline",
        "value_type": "string",
        "multi": false,
        "required": false,
        "parser": "tree_sitter"
      }
    ],
    "config": [
      {
        "field_id": "config.file.path",
        "value_type": "string",
        "multi": false,
        "required": true,
        "parser": "tree_sitter"
      },
      {
        "field_id": "config.file.format",
        "value_type": "string",
        "multi": false,
        "required": true,
        "parser": "tree_sitter",
        "description": "json, yaml, xml"
      },
      {
        "field_id": "config.structure.toplevel_keys",
        "value_type": "list",
        "multi": true,
        "required": false,
        "parser": "tree_sitter",
        "description": "Root-level keys in config file"
      },
      {
        "field_id": "config.structure.nested_paths",
        "value_type": "list",
        "multi": true,
        "required": false,
        "parser": "tree_sitter",
        "description": "Dot-notation paths to all nested keys (e.g., database.connection.host)"
      },
      {
        "field_id": "config.structure.depth",
        "value_type": "integer",
        "multi": false,
        "required": false,
        "parser": "tree_sitter",
        "description": "Maximum nesting depth"
      },
      {
        "field_id": "config.settings.parameter_names",
        "value_type": "list",
        "multi": true,
        "required": false,
        "parser": "tree_sitter",
        "description": "All parameter/setting names found"
      },
      {
        "field_id": "config.settings.env_vars",
        "value_type": "list",
        "multi": true,
        "required": false,
        "parser": "tree_sitter",
        "description": "Environment variable references (${VAR}, %VAR%, etc.)"
      },
      {
        "field_id": "config.database.connection_strings",
        "value_type": "list",
        "multi": true,
        "required": false,
        "parser": "tree_sitter",
        "description": "Database connection info (redacted secrets)"
      },
      {
        "field_id": "config.api.endpoints",
        "value_type": "list",
        "multi": true,
        "required": false,
        "parser": "tree_sitter",
        "description": "API URLs and endpoints"
      },
      {
        "field_id": "config.api.hosts",
        "value_type": "list",
        "multi": true,
        "required": false,
        "parser": "tree_sitter",
        "description": "Host URLs and domains"
      }
    ],
    "text": [
      {
        "field_id": "doc.title",
        "value_type": "string",
        "multi": false,
        "required": false,
        "parser": "text_extractor"
      },
      {
        "field_id": "doc.author",
        "value_type": "string",
        "multi": false,
        "required": false,
        "parser": "text_extractor"
      },
      {
        "field_id": "doc.date",
        "value_type": "string",
        "multi": false,
        "required": false,
        "parser": "text_extractor"
      },
      {
        "field_id": "doc.version",
        "value_type": "string",
        "multi": false,
        "required": false,
        "parser": "text_extractor"
      },
      {
        "field_id": "doc.language",
        "value_type": "string",
        "multi": false,
        "required": false,
        "parser": "text_extractor"
      },
      {
        "field_id": "doc.summary",
        "value_type": "string",
        "multi": false,
        "required": false,
        "parser": "text_extractor"
      },
      {
        "field_id": "doc.key_concepts",
        "value_type": "list",
        "multi": true,
        "required": false,
        "parser": "text_extractor"
      },
      {
        "field_id": "doc.technical_terms",
        "value_type": "list",
        "multi": true,
        "required": false,
        "parser": "text_extractor"
      },
      {
        "field_id": "doc.acronyms",
        "value_type": "list",
        "multi": true,
        "required": false,
        "parser": "text_extractor"
      },
      {
        "field_id": "doc.urls",
        "value_type": "list",
        "multi": true,
        "required": false,
        "parser": "text_extractor"
      },
      {
        "field_id": "doc.code_snippets",
        "value_type": "list",
        "multi": true,
        "required": false,
        "parser": "text_extractor"
      },
      {
        "field_id": "doc.key_requirements",
        "value_type": "list",
        "multi": true,
        "required": false,
        "parser": "text_extractor"
      },
      {
        "field_id": "doc.entities",
        "value_type": "list",
        "multi": true,
        "required": false,
        "parser": "text_extractor"
      },
      {
        "field_id": "doc.references",
        "value_type": "list",
        "multi": true,
        "required": false,
        "parser": "text_extractor"
      },
      {
        "field_id": "doc.related_files",
        "value_type": "list",
        "multi": true,
        "required": false,
        "parser": "text_extractor"
      },
      {
        "field_id": "doc.api_endpoints",
        "value_type": "list",
        "multi": true,
        "required": false,
        "parser": "text_extractor"
      },
      {
        "field_id": "doc.open_questions",
        "value_type": "list",
        "multi": true,
        "required": false,
        "parser": "text_extractor"
      },
      {
        "field_id": "doc.risks",
        "value_type": "list",
        "multi": true,
        "required": false,
        "parser": "text_extractor"
      },
      {
        "field_id": "doc.decisions",
        "value_type": "list",
        "multi": true,
        "required": false,
        "parser": "text_extractor"
      },
      {
        "field_id": "doc.assumptions",
        "value_type": "list",
        "multi": true,
        "required": false,
        "parser": "text_extractor"
      },
      {
        "field_id": "doc.constraints",
        "value_type": "list",
        "multi": true,
        "required": false,
        "parser": "text_extractor"
      }
    ],
    "csv": [
      {
        "field_id": "csv.file.path",
        "value_type": "string",
        "multi": false,
        "required": true,
        "parser": "csv_parser"
      },
      {
        "field_id": "csv.file.rows",
        "value_type": "integer",
        "multi": false,
        "required": false,
        "parser": "csv_parser"
      },
      {
        "field_id": "csv.table_data",
        "value_type": "object",
        "multi": false,
        "required": true,
        "parser": "csv_parser",
        "description": "Contains headers, rows, row_count, column_count"
      },
      {
        "field_id": "csv.schema.column_names",
        "value_type": "list",
        "multi": true,
        "required": false,
        "parser": "csv_parser"
      },
      {
        "field_id": "csv.schema.column_types",
        "value_type": "list",
        "multi": true,
        "required": false,
        "parser": "csv_parser",
        "description": "Inferred types: string, integer, float, boolean, date, email, url, array"
      },
      {
        "field_id": "csv.schema.column_count",
        "value_type": "integer",
        "multi": false,
        "required": false,
        "parser": "csv_parser"
      },
      {
        "field_id": "csv.stats.row_count",
        "value_type": "integer",
        "multi": false,
        "required": false,
        "parser": "csv_parser"
      },
      {
        "field_id": "csv.stats.null_counts",
        "value_type": "object",
        "multi": false,
        "required": false,
        "parser": "csv_parser",
        "description": "Count of null/empty values per column"
      },
      {
        "field_id": "csv.stats.unique_counts",
        "value_type": "object",
        "multi": false,
        "required": false,
        "parser": "csv_parser",
        "description": "Count of unique values per column"
      },
      {
        "field_id": "csv.sample.first_rows",
        "value_type": "list",
        "multi": true,
        "required": false,
        "parser": "csv_parser",
        "description": "First 5 rows as preview"
      }
    ]
  },
  "snapshot_templates": {
    "code": {
      "meta": {
        "project_id": "",
        "snapshot_type": "code",
        "schema_id": "notebook_schema_v2",
        "snapshot_id": "",
        "artifacts": {
          "code_intel_enabled": true,
          "text_intel_enabled": false,
          "connections_enabled": true,
          "security_scan_enabled": true
        }
      },
      "fields": {},
      "code_intel": {
        "parser_runs": []
      },
      "coverage": {
        "filled_field_ids": [],
        "missing_field_ids": []
      }
    },
    "text": {
      "meta": {
        "project_id": "",
        "snapshot_type": "text",
        "schema_id": "notebook_schema",
        "snapshot_id": "",
        "artifacts": {
          "code_intel_enabled": false,
          "text_intel_enabled": true,
          "connections_enabled": false,
          "security_scan_enabled": false
        }
      },
      "fields": {},
      "text_intel": {
        "extractor_runs": []
      },
      "coverage": {
        "filled_field_ids": [],
        "missing_field_ids": []
      }
    }
  },
  "selection_rules": {
    "choose_text_when": {
      "source_kinds": ["pdf", "txt", "md", "docx", "html", "rtf", "doc"]
    },
    "choose_code_when": {
      "source_kinds": [
        "repo", "code",
        "py",
        "ts", "js",
        "java",
        "go",
        "rs",
        "cpp", "c",
        "cs",
        "rb",
        "php",
        "swift",
        "kt",
        "scala"
      ]
    },
    "choose_csv_when": {
      "source_kinds": ["csv", "tsv"]
    }
  },
  "validation_rules": {
    "parser_field_enforcement": {
      "enabled": true,
      "description": "Enforce that parsers only fill fields they are authorized for",
      "action_on_violation": "reject"
    },
    "required_field_validation": {
      "enabled": true,
      "description": "Validate required fields are present",
      "action_on_missing": "warn"
    },
    "fallback_parser_rules": {
      "enabled": true,
      "description": "Use fallback parser when primary parser fails",
      "tree_sitter_fallback": "basic_parser"
    }
  }
}
